{{>adminnav}}
<section class="container-fluid banner admin-comments"></section>
<section class="container-fluid results">
  <div class="big-avatar" style="background: #35396e url({{user.avatar}}) no-repeat center center / cover;">
    <span class="cat-label">
      <div class="label-dark" tabindex="0">{{user.role}}</div>
    </span>
  </div>
  <div class="container admin-pages">
    <div class="row justify-content-between">
      <div class="col-12 col-sm-8 search-input">
        <form>
          <label for="comments">search comments
            <input name="comments" id="comments" placeholder="filter by comment content">
            <a class="comments-filter"><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search"
                fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                  d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z" />
                <path fill-rule="evenodd"
                  d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z" />
              </svg>
            </a>
          </label>
        </form>
        <hr>
        <div class="comments-result">
          <h1 class="title">all comments</h1>
          {{#each comments as |comment|}}
          <div class="info">
            <div class="row">
              <div class="col-4">
                <div class="avatar"
                  style="background: url({{comment.authorId.avatar}}) no-repeat center center / cover; width: 4rem; height: 4rem; display:block">
                </div>
                <span class="user">
                  <p>posted by <br><a href="/user/{{comment.authorId._id}}"> @{{comment.authorId.username}}</a></p>
                </span>
              </div>
              <div class="col-8">
                {{#if comment.verify}}
                <p class="label-pill verified">this comment was verified</p>
                {{/if}}
                <p>comment posted in <strong>{{comment.spotId.name}}</strong></p>
                <p>{{comment.content}}</p>
                <a href="/admin/comment/{{comment._id}}/delete" class="btn-delete" title="delete comment"><svg
                    aria-hidden="true" focusable="false" data-prefix="far" data-icon="comment-slash" role="img"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                    <path fill="currentColor"
                      d="M320 80c114.7 0 208 71.8 208 160 0 25.3-7.9 49.1-21.5 70.4l37.9 29.6c20.1-29.6 31.6-63.7 31.6-100 0-114.9-114.6-208-256-208-48.2 0-93 11-131.5 29.8l43 33.6C258.4 85.6 288.3 80 320 80zm0 320c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C133.7 314.1 112 282.2 112 240c0-16.6 3.3-32.7 9.5-47.8L82.8 162c-12 24.1-18.8 50.4-18.8 78 0 47.6 19.9 91.2 52.9 126.3-14.9 39.4-45.9 72.8-46.4 73.2-6.6 7-8.4 17.2-4.6 26S78.4 480 88 480c61.5 0 110-25.7 139.1-46.3C256 442.8 287.2 448 320 448c37.5 0 73-6.7 105.1-18.5l-46.2-36.2c-18.7 4.3-38.5 6.7-58.9 6.7zm314 71L481.6 351.8l-6.8-5.3L36 3.5C29.1-2 19-.9 13.5 6l-10 12.5C-2 25.4-.9 35.5 6 41l598 467.5c6.9 5.5 17 4.4 22.5-2.5l10-12.5c5.5-6.9 4.4-17-2.5-22.5z"
                      class=""></path>
                  </svg></a>
              </div>
            </div>
          </div>
          <hr>
          {{/each}}
        </div>
      </div>
      <div class="col-12 col-sm-3 not-allowed-result">
        <h2>not allowed comments</h2>
        {{#each result as |comment|}}
        <div class="info">
          <div class="row">
            <div class="col-12">
              <div class="avatar"
                style="background: url({{comment.authorId.avatar}}) no-repeat center center / cover; width: 4rem; height: 4rem; display:block">
              </div>
              <span class="user justify-content-start" style="margin-left:4rem">
                <p>posted by <br><a href="/user/{{comment.authorId._id}}"> @{{comment.authorId.username}}</a></p>
              </span>
            </div>
            <div class="col-12">
              <p>Comment posted in <strong>{{comment.spotId.name}}</strong></p>
              <p>{{comment.content}}</p>
              <div class="row">
                <div class="col d-flex">
                  <a href="/admin/comment/{{comment._id}}/delete" class="btn-delete" title="delete comment">
                    <svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="comment-slash" role="img"
                      xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                      <path fill="currentColor"
                        d="M320 80c114.7 0 208 71.8 208 160 0 25.3-7.9 49.1-21.5 70.4l37.9 29.6c20.1-29.6 31.6-63.7 31.6-100 0-114.9-114.6-208-256-208-48.2 0-93 11-131.5 29.8l43 33.6C258.4 85.6 288.3 80 320 80zm0 320c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C133.7 314.1 112 282.2 112 240c0-16.6 3.3-32.7 9.5-47.8L82.8 162c-12 24.1-18.8 50.4-18.8 78 0 47.6 19.9 91.2 52.9 126.3-14.9 39.4-45.9 72.8-46.4 73.2-6.6 7-8.4 17.2-4.6 26S78.4 480 88 480c61.5 0 110-25.7 139.1-46.3C256 442.8 287.2 448 320 448c37.5 0 73-6.7 105.1-18.5l-46.2-36.2c-18.7 4.3-38.5 6.7-58.9 6.7zm314 71L481.6 351.8l-6.8-5.3L36 3.5C29.1-2 19-.9 13.5 6l-10 12.5C-2 25.4-.9 35.5 6 41l598 467.5c6.9 5.5 17 4.4 22.5-2.5l10-12.5c5.5-6.9 4.4-17-2.5-22.5z"
                        class=""></path>
                    </svg>
                  </a>

                  <a href="/admin/comment/{{comment._id}}/aprove" class="btn-delete" title="aprove comment">
                    <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="comment-check" role="img"
                      xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                      <path fill="currentColor"
                        d="M345.3 166.5c-1.6-1.6-3.6-2.3-5.7-2.3-2 0-4.1.8-5.7 2.3L226.5 273.9 178 225.4c-1.6-1.6-3.6-2.3-5.7-2.3-2 0-4.1.8-5.7 2.3l-11.3 11.3c-3.1 3.1-3.1 8.2 0 11.3l65.5 65.5c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3L356.7 189c3.1-3.1 3.1-8.2 0-11.3l-11.4-11.2zM256 32C114.6 32 0 125.1 0 240c0 47.6 19.9 91.2 52.9 126.3C38 405.7 7 439.1 6.5 439.5c-6.6 7-8.4 17.2-4.6 26S14.4 480 24 480c61.5 0 110-25.7 139.1-46.3C192 442.8 223.2 448 256 448c141.4 0 256-93.1 256-208S397.4 32 256 32zm0 384c-28.3 0-56.3-4.3-83.2-12.8l-15.2-4.8-13 9.2c-23 16.3-58.5 35.3-102.6 39.6 12-15.1 29.8-40.4 40.8-69.6l7.1-18.7-13.7-14.6C47.3 313.7 32 277.6 32 240c0-97 100.5-176 224-176s224 79 224 176-100.5 176-224 176z"
                        class=""></path>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <hr>
        {{/each}}
      </div>
    </div>
  </div>
</section>


<script>
  //User filter
  const usersJson = '/admin/data/users'
  const commentsJson = '/admin/data/comments'
  const commentsFilter = document.querySelector('.comments-filter')
  const commentsColumn = document.querySelector('.comments-result')
  const commentsInput = document.querySelector('#comments')

  commentsFilter.addEventListener('click', () => {
    axios
      .all([axios.get(commentsJson), axios.get(usersJson)])
      .then((responses) => {

        const comments = responses[0]
        const users = responses[1]

        commentsColumn.innerHTML = ''
        let results = []

        comments.data.forEach((comen) => {
          if (
            comen.content
              .toLowerCase()
              .normalize('NFD')
              .replace(/[\u0300-\u036f]/g, '')
              .includes(
                commentsInput.value
                  .normalize('NFD')
                  .replace(/[\u0300-\u036f]/g, '')
                  .toLowerCase()
              )
          ) {
            users.data.forEach(usuario => {
              if (comen.authorId === usuario._id) {
                results.push([comen, usuario])
              }
            })
            //console.log(results)
          }
        })


        results.forEach((el) => {
          const info = document.createElement('div')
          const hr = document.createElement('hr')

          info.setAttribute('class', 'info')
          info.innerHTML = `
            <div class="row">
              <div class="col-4">
                <div class="avatar"
                  style="background: url(${el[1].avatar}) no-repeat center center / cover; width: 4rem; height: 4rem; display:block">
                </div>
                <span class="user">
                  <p>posted by <br><a href="/user/{{comment.authorId._id}}"> @${el[1].username}</a></p>
                </span>
              </div>
              <div class="col-8">
                <p>${el[0].content}</p>
                <a href="/admin/comment/${el[0]._id}/delete" class="btn-delete" title="delete comment"><svg aria-hidden="true"
                    focusable="false" data-prefix="far" data-icon="comment-slash" role="img"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                    <path fill="currentColor"
                      d="M320 80c114.7 0 208 71.8 208 160 0 25.3-7.9 49.1-21.5 70.4l37.9 29.6c20.1-29.6 31.6-63.7 31.6-100 0-114.9-114.6-208-256-208-48.2 0-93 11-131.5 29.8l43 33.6C258.4 85.6 288.3 80 320 80zm0 320c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C133.7 314.1 112 282.2 112 240c0-16.6 3.3-32.7 9.5-47.8L82.8 162c-12 24.1-18.8 50.4-18.8 78 0 47.6 19.9 91.2 52.9 126.3-14.9 39.4-45.9 72.8-46.4 73.2-6.6 7-8.4 17.2-4.6 26S78.4 480 88 480c61.5 0 110-25.7 139.1-46.3C256 442.8 287.2 448 320 448c37.5 0 73-6.7 105.1-18.5l-46.2-36.2c-18.7 4.3-38.5 6.7-58.9 6.7zm314 71L481.6 351.8l-6.8-5.3L36 3.5C29.1-2 19-.9 13.5 6l-10 12.5C-2 25.4-.9 35.5 6 41l598 467.5c6.9 5.5 17 4.4 22.5-2.5l10-12.5c5.5-6.9 4.4-17-2.5-22.5z"
                      class=""></path>
                  </svg></a>
              </div>
            </div>
            `
          commentsColumn.appendChild(info)
          commentsColumn.appendChild(hr)
        })
      })
      .catch((err) => console.log('Error while getting the data: ', err))
  })
</script>